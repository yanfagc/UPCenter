<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="org.hanzhdy.manager.upc.mapper.MenuItemMapperExt">
  <select id="countAsList" parameterType="java.util.HashMap" resultType="int">
  SELECT COUNT(1)AS ic FROM r_menuitem i <include refid="wherecause_menuitem"/>
  </select>
  
  <select id="selectAsList" parameterType="java.util.HashMap" resultType="org.hanzhdy.manager.upc.vo.MenuVo">
  <include refid="Pageable_Prefix" />
    SELECT
      i.ID AS id,
      i.ITEMCODE AS CODE,
      i.ITEMNAME AS NAME,
      'RES' AS urltype,
      'SHOW' AS showflag,
      i.RESOURCE AS url,
      i.STATUS AS status,
      i.SORT AS sort
    FROM r_menuitem i
    <include refid="wherecause_menuitem"/>
    ORDER BY i.SORT ASC
    <include refid="Pageable_Suffix" />
  </select>
  
  <sql id="wherecause_menuitem">
  WHERE i.MENUID = #{parentid}
    <if test="searchkey!=null and searchkey!=''">
    AND (ITEMCODE LIKE #{searchkey} OR ITEMCODE LIKE #{searchkey})
    </if>
    <if test="status!=null and status!=''">
    AND STATUS=#{status}
    </if>
  </sql>

  <!-- 根据用户和系统ID查询该用于在系统中所拥有的权限信息 -->
  <select id="selectByUserAndSysId" parameterType="java.util.HashMap" resultMap="BaseResultMap">
SELECT DISTINCT
	mi.*
FROM
	r_role r,
	r_menu m,
	r_menuitem mi,
	r_role_menu rm,
	r_role_menuitem rmi,
	r_user_role ur
WHERE
	r.SYSTEMID = #{systemid}
AND ur.USERID = #{userid}
AND ur.ROLEID = r.ID
AND r.`STATUS` = 'N'
AND r.ID = rm.ROLEID
AND m.ID = rm.MENUID
AND m.`STATUS` = 'N'
AND mi.MENUID = M.ID
AND mi.`STATUS` = 'N'
AND rmi.ROLEID = r.ID
AND rmi.ITEMID = mi.ID
  </select>
</mapper>